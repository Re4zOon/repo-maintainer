# Stale Branch/Merge Request Notifier Configuration
# Copy this file to config.local.yaml and fill in your values

# =============================================================================
# Platform Selection
# =============================================================================
# Choose which platform to use: "gitlab" (default) or "github"
# platform: gitlab

# =============================================================================
# GitLab connection settings (used when platform is "gitlab" or not set)
# =============================================================================
gitlab:
  url: "https://gitlab.example.com"
  private_token: "your-gitlab-private-token"

# =============================================================================
# GitHub connection settings (used when platform is "github")
# =============================================================================
# github:
#   token: "ghp_your-github-personal-access-token"
#   # Optional: GitHub Enterprise base URL (omit for github.com)
#   # api_url: "https://github.example.com/api/v3"

# =============================================================================
# Projects / Repositories to monitor
# =============================================================================
# IMPORTANT: Only the repositories listed here will be scanned.
# This script does NOT scan all repositories in your instance.
# You must explicitly list each project/repository you want to monitor.
#
# For GitLab: Use numeric project IDs
#   To find a project's ID:
#   - In GitLab UI: Go to project page â†’ "Project overview" or "Settings > General"
#   - Via API: GET /api/v4/projects?search=project-name
#
# For GitHub: Use "owner/repo" format
#   e.g., "octocat/Hello-World"
projects:
  - 123
  - 456
  - 789

# Number of days after which a branch is considered stale
stale_days: 30

# Number of weeks until automatic cleanup/archiving
# After a branch/MR has been stale for stale_days + (cleanup_weeks * 7) days,
# it becomes eligible for automatic archiving (if enabled)
cleanup_weeks: 4

# Notification frequency (in days)
# Controls how often the same recipient receives notifications:
# - If a person got an email about branch A on monday and we find a new stale
#   branch/MR on wednesday, we send both on wednesday (new item triggers email)
# - Otherwise, we only send once per notification_frequency_days period
# Default: 7 (once per week)
notification_frequency_days: 7

# Path to SQLite database for tracking notification history
# This database stores when each recipient was last notified about each item
# to prevent sending duplicate notifications too frequently
# Default: ./notification_history.db
database_path: "./notification_history.db"

# Fallback email address for:
# - Inactive users (committers whose GitLab accounts are inactive)
# - Merge requests where assignee/author email cannot be determined
# Notifications will be sent here as a fallback
fallback_email: "repo-maintainers@example.com"

# SMTP server settings for sending emails
smtp:
  host: "smtp.example.com"
  port: 587
  use_tls: true
  username: "notifications@example.com"
  password: "your-smtp-password"
  from_email: "GitLab Maintenance <notifications@example.com>"

# =============================================================================
# Performance Settings
# =============================================================================
# Controls for optimizing performance when working with large repositories
# and multiple projects.

# Maximum number of worker threads for parallel processing
# The tool uses parallel processing to:
# - Process multiple projects concurrently
# - Fetch branches and merge requests in parallel
# - Speed up archiving operations
#
# Higher values increase speed but also memory and API load, and can
# increase the risk of hitting GitLab API rate limits because more
# requests are made in parallel. If you see rate-limit errors from
# GitLab (HTTP 429 or similar), reduce this value and/or stagger runs.
# Recommended values:
# - Small deployments (1-10 projects): 2-4
# - Medium deployments (10-50 projects): 4-8
# - Large deployments (50+ projects): 8-16 (use lower values if your
#   GitLab instance has strict API rate limits or many projects are
#   processed at the same time)
#
# Default: 4
max_workers: 4

# =============================================================================
# Custom Message Files (Optional)
# =============================================================================
# The bot uses funny messages for emails and MR comments that are loaded from
# text files in the 'data' directory. Each file contains 50+ message options
# that are randomly selected to keep notifications fresh and interesting.
#
# You can customize these messages by:
# 1. Editing the default files in the 'data' directory
# 2. Specifying custom file paths below
#
# File format: Each message is separated by a blank line.
# Lines starting with # are treated as comments and ignored.
# Email greetings can use {{ stale_days }} as a template variable.

# Path to custom MR reminder comments file (optional)
# Default: ./data/mr_reminder_comments.txt
# mr_comments_file: "./data/mr_reminder_comments.txt"

# Path to custom email greetings file (optional)
# Default: ./data/email_greetings.txt
# email_greetings_file: "./data/email_greetings.txt"

# =============================================================================
# Automatic Archiving Settings
# =============================================================================
# Automatic archiving safely cleans up very old stale branches and MRs by:
# 1. Exporting the branch to a local archive folder (as a compressed tar.gz)
# 2. Closing any associated merge requests (with a note explaining the closure)
# 3. Deleting the source branch
#
# A branch/MR is eligible for archiving when it has been stale for:
#   stale_days + (cleanup_weeks * 7) days
# (With the default settings: 30 + 28 = 58 days)

# Enable automatic archiving (default: false)
# When enabled via config, archiving runs automatically with notifications.
# Can also be enabled per-run with the --archive command-line flag.
enable_auto_archive: false

# Local folder to store archived branches
# Each archived branch is saved as: {project_name}_{branch_name}_{timestamp}.tar.gz
# Default: ./archived_branches
archive_folder: "./archived_branches"

# Optional whitelist of projects/repos to auto-archive.
# Notifications/checks still run for all entries in `projects`.
# If omitted, all `projects` are eligible for auto-archiving.
# auto_archive_projects:
#   - 123                  # GitLab example
#   - "myorg/config-repo"  # GitHub example

# =============================================================================
# MR Reminder Comments Settings
# =============================================================================
# When enabled, the bot will post friendly reminder comments directly on stale
# merge requests for increased visibility. This is in addition to email
# notifications and does not affect archiving behavior.
#
# Comments are posted when:
# 1. The MR has been inactive for at least mr_comment_inactivity_days (X days)
# 2. The bot hasn't commented on this MR in the last mr_comment_frequency_days (Y days)
#
# The comments are designed to be clear and friendly (with a touch of humor)
# to encourage action without being annoying. There are 50+ different comment
# options that are randomly selected to keep notifications fresh.
#
# Note: With parallel processing (max_workers > 1), multiple threads may access
# the SQLite database simultaneously when recording comments. SQLite has built-in
# retry logic with a default timeout of 5 seconds. If you experience "database is
# locked" errors with high max_workers values, consider reducing max_workers when
# MR commenting is enabled.

# Enable MR reminder comments (default: false)
enable_mr_comments: false

# Number of days of inactivity before posting the first comment (X days)
# An MR is considered inactive if there are no commits, comments, or updates
# Default: 14
mr_comment_inactivity_days: 14

# Frequency of posting new comments (Y days)
# After the first comment, a new comment will be posted every Y days
# if the MR remains inactive
# Default: 7
mr_comment_frequency_days: 7
